function istel(tel){var rtn=false;var regtel=/^((13[4-9])|(15([0-2]|[7-9]))|(18[2|3|4|7|8])|(178)|(147))[\d]{8}$/;if(regtel.test(tel)){rtn=true}regtel=/^((133)|(153)|(18[0|1|9])|(177))[\d]{8}$/;if(regtel.test(tel)){rtn=true}regtel=/^((13[0-2])|(145)|(15[5-6])|(176)|(18[5-6]))[\d]{8}$/;if(regtel.test(tel)){rtn=true}return rtn}function tipsMsg(msg){var txt=msg.errno>=1?msg.errno:"";txt+=msg.errno>=1?"-":"";for(var i in msg.data){txt+=msg.data[i]}$(".msgTips").removeClass().addClass("msgTips "+msg.type).html(txt)}function valideForm(_data){return new Promise(resolve,reject);if(!istel(_data.phone)){tipsMsg({errno:-1,type:"error",data:{"手机":"请输入正确的手机号码"}});return false}else if(!_data.pass||_data.pass.length<6||_data.pass.length>18){tipsMsg({errno:-1,type:"error",data:{"密码":"请输入正确的密码"}});return false}}var html="<div id='validateOutBox'></div>";function loginEvent(data){$("body").dialog({con:html,width:"320"});$("#validateOutBox").wylValidate({},function(res){if(res.state){$.post("/loginvalidate",data,function(res){if(res.errno>0){tipsMsg({errno:res.errno,type:"error",data:res.data});return false}if(res.data.state==1){console.log(res.data.uID);tipsMsg({errno:1,type:"success",data:res.data});$.closeDlg();sessionStorage.setItem("uid",res.data.uID);window.location.href="/admin";return false}else if(res.data.state==-2){$("body").dialog({tit:"注册验证",con:"亲还没注册哦，输入接收到的短信验证码，即可完成注册！",btns:[{state:0,txt:"取消"},{state:1,txt:"注册"}]},function(res){if(res.num==1){window.location.href="/sign"}else{$.closeDlg()}});return false}else if(res.data.state==-1){$.closeDlg();tipsMsg({errno:-1,type:"error",data:res.data});return false}else{$.closeDlg();tipsMsg({errno:-1,type:"error",data:{txt:"未知错误"}});return false}})}})}function signEvent(data){$("body").dialog({con:html,width:"320"});$("#validateOutBox").wylValidate({},function(res){if(res.state){$("body").dialog({con:html,width:"320"});$("#validateOutBox").wylsms({},function(smsRes){if(smsRes.state){$.post("/signvalidate",data,function(res){console.log(res);if(res.data.state==2){console.log(res.data.uID);tipsMsg({errno:1,type:"success",data:res.data});window.location.href="/login";return false}else{tipsMsg({errno:1,type:"success",data:res.data});return false}});$.closeDlg()}})}})}$(function(){$("input[name=password]").focus(function(){$(this).attr("type","password")}).blur(function(){if(!$(this).val()){$(this).attr("type","text")}});$("input[name=username], input[name=password]").bind("keyup",function(event){if(event.keyCode=="13"){if($(".login_sumbit").html()){$(".login_sumbit").click()}else{$(".sign_sumbit").click()}}});$(".login_sumbit").click(function(){var phone=$.trim($("input[name=username]").val());var pass=$.trim($("input[name=password]").val());valideForm({phone:phone,pass:pass},function(){});loginEvent({state:1,phone:phone,pass:pass})});$(".sign_sumbit").click(function(){var phone=$.trim($("input[name=username]").val());var pass=$.trim($("input[name=password]").val());valideForm({phone:phone,pass:pass});signEvent({state:2,phone:phone,pass:pass})})});