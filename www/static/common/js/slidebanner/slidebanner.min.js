(function($){var autoplay=function(_s,callback){return setInterval(function(){if(callback){callback(1)}},_s)};var autostop=function($timeObj){clearInterval($timeObj)};var slideEvent=function(data,callback){if(data.slide==="left"){if(data.currentNum==0){data.currentNum=data.li.length-1}else{data.currentNum--}data.arr.push(data.currentNum);if(data.arr.length>2){data.arr.shift()}if(data.arr[0]!=data.arr[1]){$(data.li).eq(data.arr[1]).css({left:-data.winWidth});$(data.li).eq(data.arr[0]).animate({opacity:0,left:data.winWidth});$(data.li).eq(data.arr[1]).animate({opacity:1,left:0},function(){if(callback){callback({arr:data.arr,num:data.currentNum})}})}else{return false}}else if(data.slide==="right"){if(data.currentNum==data.li.length-1){data.currentNum=0}else{data.currentNum++}data.arr.push(data.currentNum);if(data.arr.length>2){data.arr.shift()}if(data.arr[0]!=data.arr[1]){$(data.li).eq(data.arr[1]).css({left:data.winWidth});$(data.li).eq(data.arr[0]).animate({opacity:0,left:-data.winWidth});$(data.li).eq(data.arr[1]).animate({opacity:1,left:0},function(){if(callback){callback({arr:data.arr,num:data.currentNum})}})}else{return false}}else if(data.slide==="pointClick"){data.arr.push(data.currentNum);if(data.arr.length>2){data.arr.shift()}if(data.arr[0]!=data.arr[1]){$(data.li).eq(data.arr[1]).css({left:data.winWidth});$(data.li).eq(data.arr[0]).animate({opacity:0,left:-data.winWidth});$(data.li).eq(data.arr[1]).animate({opacity:1,left:0},function(){if(callback){callback({arr:data.arr,num:data.currentNum})}})}else{return false}}data.el.find(".sbtnUl>li").removeClass("active").eq(data.currentNum).addClass("active")};var touchEvent=function(el,leftFun,rightFun,clickFun){var x1,x2,x,x3,y3,moved;$(el).bind("touchstart",function(e){moved=false;var _touch=e.originalEvent.targetTouches[0];x1=_touch.pageX;y1=_touch.pageY});$(el).bind("touchmovie",function(e){if(moved)return;x3=e.targetTouches[0].screenX;y3=e.targetTouches[0].screenY;if(y3-y1<30){moved=true}else{moved=false}});$(el).bind("touchend",function(e){var _this=$(this);if(!moved){var _touch=e.originalEvent.changedTouches[0];x2=_touch.pageX;y2=_touch.pageY;x=x2-x1;if(x>30){leftFun()}else if(x<-30){rightFun()}else{clickFun(el)}}})};var touchStopDefault=function(obj){$(obj).bind("touchstart",function(e){});$(obj).bind("touchmovie",function(e){e.stopPropagation();e.preventDefault()});$(obj).bind("touchend",function(e){e.stopPropagation();e.preventDefault()})};var touchClick=function(obj,callback){var xs="";var xe="";var ys="";var ye="";$(obj).bind("touchstart",function(event){var _touch1=event.originalEvent.targetTouches[0];xs=_touch1.clientX;ys=_touch1.clientY});$(obj).bind("touchend",function(event){var _this=$(this);var _touch2=event.originalEvent.changedTouches[0];xe=_touch2.clientX;ys=_touch2.clientY;if(Math.abs(xe-xs)<=30||Math.abs(ye-ys)<=30){if(callback){callback(_this)}}else{if(callback){callback(0)}}})};$.fn.albumEvent=function(options,callback){var defaults={showBtn:true,showPoint:true,showTime:5e3};var opts=jQuery.extend(defaults,options);return this.each(function(){var $this=$(this);var li=$this.find(".albumUl").find("li");var obj={};var arr=[];var autoTimeObj=null;obj.currentNum=0;var w="100%";arr.push(obj.currentNum);$this.find(".albumUl>li").css({opacity:0,width:w,left:-w}).eq(arr[0]).css({opacity:1,left:0});var heightTime=setInterval(function(){var height=$this.find(".albumUl>li>p>img").height();if(height){$this.css("height",Math.floor(height));clearInterval(heightTime)}},100);$(window).resize(function(){var heightTime=setInterval(function(){var height=$this.find(".albumUl>li>p>img").height();if(height){$this.css("height",Math.floor(height));clearInterval(heightTime)}},100)});autoPlayFn();function autoPlayFn(){autoTimeObj=autoplay(opts.showTime,function(e){if(e){slideEvent({el:$this,slide:"right",currentNum:obj.currentNum,li:li,arr:arr,winWidth:w},function(data){arr=data.arr;obj.currentNum=data.num})}})}if(opts.showBtn){obj.html="<a class='albumBtn albumleft' href='javascript:void(null)'><i class='iconfont icon-shangyige'></i></a><a class='albumBtn albumright' href='javascript:void(null)'><i class='iconfont icon-guanbi01'></i></a>";$this.append(obj.html);touchClick($this.find(".albumleft"),function(_this){autostop(autoTimeObj);slideEvent({el:$this,slide:"left",currentNum:obj.currentNum,li:li,arr:arr,winWidth:w},function(data){arr=data.arr;obj.currentNum=data.num;autoPlayFn()})});touchClick($this.find(".albumright"),function(_this){autostop(autoTimeObj);slideEvent({el:$this,slide:"right",currentNum:obj.currentNum,li:li,arr:arr,winWidth:w},function(data){arr=data.arr;obj.currentNum=data.num;autoPlayFn()})})}if(opts.showPoint){obj.pointhtml="<ul class='sbtnUl'>";for(var i=0;i<li.length;i++){obj.pointhtml+="<li class='sbtnLi' ></li>"}obj.pointhtml+="</ul>";$this.append(obj.pointhtml);$this.find(".sbtnUl>li").removeClass("active").eq(obj.currentNum).addClass("active");touchClick(".sbtnUl>li",function(_this){autostop(autoTimeObj);slideEvent({el:$this,slide:"pointClick",currentNum:$(_this).index(),li:li,arr:arr,winWidth:w},function(data){arr=data.arr;obj.currentNum=data.num;autoPlayFn()})})}touchStopDefault($this.find(".albumUl"));touchStopDefault($this);touchEvent(li,function(){autostop(autoTimeObj);slideEvent({el:$this,slide:"left",currentNum:obj.currentNum,li:li,arr:arr,winWidth:w},function(data){arr=data.arr;obj.currentNum=data.num;autoPlayFn()})},function(){autostop(autoTimeObj);slideEvent({el:$this,slide:"right",currentNum:obj.currentNum,li:li,arr:arr,winWidth:w},function(data){arr=data.arr;obj.currentNum=data.num;autoPlayFn()})},function(el){if(callback){callback($(el).eq(obj.currentNum))}})})}})(window.jQuery);